name: Release
on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Environment to release'
        type: environment
        required: true

jobs:
  release_echo:
    env:
      ENVIRONMENT: ${{ inputs.environment }}
    runs-on: ubuntu-latest
    environment: ${{ inputs.environment }}
    steps:
      - uses: ./.github/workflows/set_env.yml
      - run: |
          echo "Environment: $aaa"
  
  build_and_test:
    name: Build & test
    uses: ./.github/workflows/build_and_test.yml
    
  deploy_to_staging:
    name: Deploy to Staging
    needs: build_and_test
    uses: ./.github/workflows/deploy.yml
    with:
      environment: Staging
    secrets: inherit
    
  deploy_to_production:
    name: Deploy to Production
    needs: [build_and_test, deploy_to_staging]
    uses: ./.github/workflows/deploy.yml
    with:
      environment: Production
    secrets: inherit
